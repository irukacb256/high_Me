{% extends 'base_main.html' %}
{% load humanize %}

{% block content %}
<style>
    .achievements-container {
        padding: 20px;
        background: #f9f9f9;
        min-height: 100vh;
    }

    /* Header Section */
    .achievements-header {
        display: flex;
        flex-direction: column;
        align-items: center;
        background: white;
        padding: 30px 20px;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        margin-bottom: 20px;
    }

    /* Badge Shape */
    .shape-wrapper {
        width: 100px;
        height: 100px;
        margin-bottom: 20px;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .grade-badge {
        width: 100px;
        height: 100px;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    /* ROOKIE: Triangle (Green) */
    .grade-rookie .grade-badge {
        background: linear-gradient(135deg, #00D930, #00C920);
        clip-path: polygon(0% 0%, 100% 50%, 0% 100%);
        width: 90px;
        /* Adjust aspect */
    }

    /* HOPE: Diamond (Blue) */
    .grade-hope .grade-badge {
        background: linear-gradient(135deg, #007AFF, #0055EE);
        clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
    }

    /* ACE: Pentagon (Orange) */
    .grade-ace .grade-badge {
        background: linear-gradient(135deg, #FF9500, #FF7500);
        clip-path: polygon(50% 0%, 100% 38%, 82% 100%, 18% 100%, 0% 38%);
    }

    /* MASTER: Hexagon (Red) */
    .grade-master .grade-badge {
        background: linear-gradient(135deg, #FF3B30, #FF0000);
        clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%);
    }

    .grade-initial {
        font-size: 40px;
        font-weight: bold;
        color: white;
        z-index: 1;
        /* Center text accurately in shapes */
        margin-right: 0;
    }

    /* Adjust text pos for triangle */
    .grade-rookie .grade-initial {
        padding-right: 15px;
        /* Visual centering */
    }

    /* Text Info */
    .membership-label {
        font-size: 14px;
        color: #333;
        font-weight: bold;
        margin-bottom: 5px;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .grade-title {
        font-size: 42px;
        font-weight: 900;
        text-transform: uppercase;
        color: #333;
        margin-bottom: 20px;
        line-height: 1;
    }

    /* Progress Bar */
    .level-info {
        width: 100%;
        max-width: 400px;
    }

    .level-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
        margin-bottom: 8px;
        color: #888;
        font-size: 14px;
    }

    .current-level {
        font-size: 28px;
        font-weight: bold;
        color: #333;
    }

    .progress-bar-bg {
        width: 100%;
        height: 10px;
        background: #eee;
        border-radius: 5px;
        overflow: hidden;
    }

    .progress-bar-fill {
        height: 100%;
        background: #FF3B30;
        /* Timee Red */
        border-radius: 5px;
        transition: width 0.5s ease;
    }

    .explanation-text {
        margin-top: 15px;
        font-size: 12px;
        color: #666;
        text-align: left;
        width: 100%;
        max-width: 400px;
    }

    /* Stats Grid */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        margin-bottom: 30px;
    }

    .stat-item {
        text-align: center;
    }

    .stat-value {
        font-size: 24px;
        font-weight: bold;
        color: #333;
    }

    .stat-label {
        font-size: 11px;
        color: #888;
    }

    /* History List */
    .history-section {
        background: white;
        border-radius: 12px;
        padding: 20px;
    }

    .history-title {
        font-size: 16px;
        font-weight: bold;
        margin-bottom: 15px;
        color: #333;
    }

    .history-table {
        width: 100%;
        border-collapse: collapse;
    }

    .history-table th {
        text-align: left;
        font-size: 12px;
        color: #888;
        padding-bottom: 10px;
        font-weight: normal;
    }

    .history-table td {
        padding: 12px 0;
        font-size: 14px;
        color: #333;
        border-bottom: 1px solid #eee;
    }

    .history-date {
        color: #999;
        font-size: 12px;
    }

    .exp-plus {
        font-weight: bold;
        text-align: right;
    }
</style>

<div class="achievements-container">
    {% with grade=membership.grade %}
    <div class="achievements-header grade-{{ grade|lower }}">
        <div class="shape-wrapper">
            <div class="grade-badge">
                <span class="grade-initial">{{ grade|slice:":1" }}</span>
            </div>
        </div>

        <div class="membership-label">
            Timee Membership <i class="fa-regular fa-circle-question"></i>
        </div>

        <div class="grade-title">{{ grade }}</div>

        <div class="level-info">
            <div class="level-header">
                <span>次のレベルまで {{ needed_exp }}EXP</span>
                <span>Lv <span class="current-level">{{ membership.level }}</span></span>
            </div>
            <div class="progress-bar-bg">
                <div class="progress-bar-fill" style="width: {{ progress_percent }}%;"></div>
            </div>
        </div>

        <div class="explanation-text">
            あなたがタイミーで獲得したEXPにもとづいて、Lvとグレードが決まります。
        </div>
    </div>
    {% endwith %}

    <div class="stats-grid">
        <div class="stat-item">
            <div class="stat-value">{{ work_count }}<span style="font-size:12px;">回</span></div>
            <div class="stat-label">働いた回数</div>
        </div>
        <div class="stat-item">
            <div class="stat-value">{{ work_hours }}<span style="font-size:12px;">h</span></div>
            <div class="stat-label">働いた時間</div>
        </div>
        <div class="stat-item">
            <div class="stat-value">{{ good_rate }}<span style="font-size:12px;">%</span></div>
            <div class="stat-label">Good率</div>
        </div>
    </div>

    <div class="history-section">
        <div class="history-title">EXP獲得履歴</div>

        <table class="history-table">
            <thead>
                <tr>
                    <th style="width: 30%;">日付</th>
                    <th style="width: 50%;">獲得理由</th>
                    <th style="text-align: right;">EXP</th>
                </tr>
            </thead>
            <tbody>
                {% for history in exp_history %}
                <tr>
                    <td class="history-date">{{ history.created_at|date:"Y/n/j" }}</td>
                    <td>{{ history.reason }}</td>
                    <td class="exp-plus">+{{ history.amount }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="3" style="text-align: center; color: #999; padding: 20px;">
                        まだEXP獲得履歴がありません。
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}