{% extends 'base_auth.html' %}

{% block content %}
<style>
    /* ç”»é¢å…¨ä½“ */
    .edit-container { background: white; height: 100%; display: flex; flex-direction: column; overflow: hidden; }
    .header { height: 60px; display: flex; align-items: center; padding: 0 15px; border-bottom: 1px solid #eee; flex-shrink: 0; }
    .header-title { flex: 1; text-align: center; font-weight: bold; font-size: 16px; margin-right: 30px; }

    .form-scroll { flex: 1; overflow-y: auto; padding: 20px 0; }
    
    /* ã‚¢ãƒã‚¿ãƒ¼ */
    .avatar-section { text-align: center; margin-bottom: 30px; }
    .avatar-circle { width: 100px; height: 100px; border-radius: 50%; background: #eee; margin: 0 auto 10px; border: 2px solid #ff3b30; display: flex; align-items: center; justify-content: center; font-size: 40px; color: #aaa; overflow: hidden; }
    .avatar-circle img { width: 100%; height: 100%; object-fit: cover; }
    .change-photo-link { color: #007AFF; font-size: 13px; font-weight: bold; text-decoration: none; cursor: pointer; }

    /* â˜…ä¿®æ­£ã®è¦ï¼šå§“åãƒ»ã‚«ãƒŠã®ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
    .field-grid-row { 
        display: grid; 
        grid-template-columns: 1fr 1fr; /* å·¦å³50%ãšã¤ */
        gap: 15px; 
        padding: 15px 20px; 
        border-bottom: 1px solid #f2f2f2; 
    }
    .input-pair { 
        display: flex; 
        align-items: center; 
        gap: 8px; 
        min-width: 0; /* å­è¦ç´ ãŒã¯ã¿å‡ºã•ãªã„ã‚ˆã†ã«ã™ã‚‹ */
    }
    .field-label { 
        font-size: 14px; 
        color: #999; 
        white-space: nowrap; /* ã€Œå§“ã€ãªã©ã®æ–‡å­—ãŒæ”¹è¡Œã•ã‚Œãªã„ã‚ˆã†ã« */
        flex-shrink: 0; 
    }
    .field-input-box { 
        flex: 1; 
        min-width: 0; /* â˜…ã“ã‚ŒãŒé‡è¦ï¼šinputãŒè¦ªã®å¹…ã«åˆã‚ã›ã¦ç¸®ã‚€ã‚ˆã†ã«ãªã‚‹ */
        background: #f2f2f2; 
        padding: 12px 10px; 
        border-radius: 6px; 
        border: none; 
        font-size: 15px; 
        outline: none;
        box-sizing: border-box;
    }

    /* å˜ä¸€è¡Œã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆç”Ÿå¹´æœˆæ—¥ã€æ€§åˆ¥ã€ä½æ‰€ï¼‰ */
    .field-single-row {
        display: flex;
        align-items: center;
        padding: 15px 20px;
        border-bottom: 1px solid #f2f2f2;
    }
    .single-label { width: 80px; font-size: 14px; color: #999; flex-shrink: 0; }

    /* ä¸‹éƒ¨ãƒœã‚¿ãƒ³ */
    .footer { padding: 15px 20px 30px; border-top: 1px solid #eee; background: white; flex-shrink: 0; }
    .btn-save { width: 100%; padding: 16px; background: #007AFF; color: white; border: none; border-radius: 10px; font-weight: bold; font-size: 16px; cursor: pointer; }
</style>

<div class="edit-container">
    <div class="header">
        <a href="{% url 'account_settings' %}" style="text-decoration:none; color:black; font-size:24px;">Ã—</a>
        <div class="header-title">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†</div>
    </div>

    <form method="POST" enctype="multipart/form-data" style="display:contents;">
    {% csrf_token %}
    <div class="form-scroll">
        <div class="avatar-section">
            <div class="avatar-circle" id="imagePreview">
                {% if profile.profile_image %}
                    <!-- ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ç”»åƒã‚’è¡¨ç¤º -->
                    <img src="{{ profile.profile_image.url }}" style="width:100%; height:100%; object-fit:cover;">
                {% else %}
                    <!-- ç”»åƒãŒãªã„å ´åˆã¯ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¡¨ç¤º -->
                    <span style="font-size: 40px; color: #aaa;">ğŸ‘¤</span>
                {% endif %}
            </div>
            <label class="change-photo-link">
                ã‚¿ãƒƒãƒ—ã—ã¦ç”»åƒã‚’å¤‰æ›´
                <input type="file" name="profile_image" id="id_profile_image" style="display:none;" onchange="previewImage(this)">
            </label>
        </div>
        <!-- ... ä»¥ä¸‹ã€å…¥åŠ›é …ç›®ï¼ˆå‰å›ã®ä¿®æ­£ç‰ˆã¨åŒã˜ï¼‰ ... -->
    </div>


            <!-- å§“åè¡Œï¼ˆã‚°ãƒªãƒƒãƒ‰ã§50%ãšã¤åˆ†å‰²ï¼‰ -->
            <div class="field-grid-row">
                <div class="input-pair">
                    <span class="field-label">å§“</span>
                    <input type="text" name="last_name" class="field-input-box" value="{{ profile.user.last_name }}" placeholder="ä¾‹: å±±ç”°">
                </div>
                <div class="input-pair">
                    <span class="field-label">å</span>
                    <input type="text" name="first_name" class="field-input-box" value="{{ profile.user.first_name }}" placeholder="ä¾‹: å¤ªéƒ">
                </div>
            </div>

            <!-- ã‚«ãƒŠè¡Œ -->
            <div class="field-grid-row">
                <div class="input-pair">
                    <span class="field-label">ã‚»ã‚¤</span>
                    <input type="text" name="last_kana" class="field-input-box" value="{{ profile.last_name_kana }}" placeholder="ãƒ¤ãƒãƒ€">
                </div>
                <div class="input-pair">
                    <span class="field-label">ãƒ¡ã‚¤</span>
                    <input type="text" name="first_kana" class="field-input-box" value="{{ profile.first_name_kana }}" placeholder="ã‚¿ãƒ­ã‚¦">
                </div>
            </div>

            <!-- ç”Ÿå¹´æœˆæ—¥ -->
            <div class="field-single-row">
                <span class="single-label">ç”Ÿå¹´æœˆæ—¥</span>
                <input type="date" name="birth_date" class="field-input-box" value="{{ profile.birth_date|date:'Y-m-d' }}">
            </div>

            <!-- æ€§åˆ¥ -->
            <div class="field-single-row">
                <span class="single-label">æ€§åˆ¥</span>
                <select name="gender" class="field-input-box">
                    <option value="ç”·æ€§" {% if profile.gender == 'ç”·æ€§' %}selected{% endif %}>ç”·æ€§</option>
                    <option value="å¥³æ€§" {% if profile.gender == 'å¥³æ€§' %}selected{% endif %}>å¥³æ€§</option>
                </select>
            </div>

            <!-- ä½æ‰€ -->
            <div class="field-single-row">
                <span class="single-label">ä½æ‰€</span>
                <div class="field-input-box" style="display:flex; justify-content:space-between; align-items:center;">
                    <span style="color:#333; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ profile.prefecture }}{{ profile.address }}</span>
                    <i class="fa-solid fa-chevron-right" style="color:#ccc; font-size:12px; margin-left:10px;"></i>
                </div>
            </div>
        </div>

        <div class="footer">
            <button type="submit" class="btn-save">å¤‰æ›´ã‚’ä¿å­˜</button>
        </div>
    </form>
    <script>
    // é¸æŠã—ãŸç”»åƒã‚’ä¿å­˜å‰ã«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºã™ã‚‹JavaScript
    function previewImage(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function(e) {
                var container = document.getElementById('imagePreview');
                container.innerHTML = '<img src="' + e.target.result + '" style="width:100%; height:100%; object-fit:cover;">';
            }
            reader.readAsDataURL(input.files[0]);
        }
    }
    </script>
</div>
{% endblock %}