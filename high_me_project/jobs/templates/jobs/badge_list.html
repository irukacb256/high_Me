{% extends 'base_main.html' %}
{% load static %}
{% load jobs_extras %}


{% block content %}
<style>
    .badge-container {
        padding: 20px;
        background: white;
        min-height: 100vh;
    }

    .header-bar {
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        margin-bottom: 20px;
    }

    .back-btn {
        position: absolute;
        left: 0;
        width: 32px;
        height: 32px;
        background: #F2F2F7;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #333;
        text-decoration: none;
    }

    .page-title {
        font-weight: bold;
        font-size: 16px;
    }

    /* ヒントボックス */
    .hint-box {
        background: #F2F2F7;
        border-radius: 12px;
        padding: 15px;
        position: relative;
        margin-bottom: 25px;
    }

    .hint-title {
        font-weight: bold;
        font-size: 14px;
        margin-bottom: 5px;
    }

    .hint-text {
        font-size: 12px;
        color: #666;
        line-height: 1.5;
    }

    .hint-close {
        position: absolute;
        top: 10px;
        right: 10px;
        background: #D1D1D6;
        color: white;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        cursor: pointer;
    }

    .description-text {
        font-size: 12px;
        color: #333;
        line-height: 1.6;
        margin-bottom: 30px;
    }

    /* バッジグリッド */
    .badge-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px 10px;
    }

    .badge-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
    }

    .badge-icon-wrapper {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        border: 4px solid #F2F2F7;
        /* 未獲得時の枠線 */
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 10px;
        position: relative;
    }

    /* 獲得済みのスタイル */
    .badge-item.obtained .badge-icon-wrapper {
        border-color: #FFD700;
        /* ゴールド枠 */
    }

    .badge-icon {
        font-size: 32px;
        color: #8E8E93;
    }

    .badge-item.obtained .badge-icon {
        color: #333;
        /* 獲得済みは濃い色 */
    }

    /* 円形プログレスバー風の装飾はCSSのみだと複雑なので今回は簡易的に枠線で表現 */

    .badge-name {
        font-weight: bold;
        font-size: 13px;
        margin-bottom: 3px;
        color: #333;
    }

    .badge-count {
        font-size: 10px;
        color: #8E8E93;
    }
</style>

<div class="badge-container">
    <div class="header-bar">
        <a href="{% url 'mypage' %}" class="back-btn"><i class="fa-solid fa-chevron-left"></i></a>
        <div class="page-title">バッジ一覧</div>
    </div>

    <div class="hint-box" id="hintBox">
        <div class="hint-close" onclick="document.getElementById('hintBox').style.display='none'"><i
                class="fa-solid fa-xmark"></i></div>
        <div class="hint-title">バッジを獲得するヒント</div>
        <div class="hint-text">
            未獲得のバッジをタップすると、獲得できる可能性がある仕事を確認できます。
        </div>
    </div>

    <div class="description-text">
        特定の業務に対して働き先に認定されるとバッジを獲得します。<br>
        以下の条件のうち1つを満たすと、時給が地域平均よりも高い募集の「バッジ限定 お仕事リクエスト」を受け取れるようになります。<br>
        ・3店舗以上からの認定<br>
        ・5回以上の認定（どの店舗からでも）
    </div>

    <div class="badge-grid">
        {% for badge in badges %}
        {% with my_badge=my_badges_dict|get_item:badge.id %}
        <div class="badge-item {% if my_badge and my_badge.is_obtained %}obtained{% endif %}">
            <div class="badge-icon-wrapper">
                {% if badge.icon %}
                <img src="{{ badge.icon.url }}" alt="{{ badge.name }}"
                    style="width:50%; height:50%; object-fit:contain; opacity: {% if my_badge and my_badge.is_obtained %}1{% else %}0.5{% endif %};">
                {% else %}
                <i class="fa-solid fa-medal badge-icon"></i>
                {% endif %}
            </div>
            <div class="badge-name">{{ badge.name }}</div>
            <div class="badge-count">
                認定された回数<br>
                {{ my_badge.certified_count|default:0 }}
            </div>
        </div>
        {% endwith %}
        {% endfor %}
    </div>
</div>
{% endblock %}