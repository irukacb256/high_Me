{% extends 'base.html' %}

{% block content %}
<style>
    /* 全体コンテナ */
    .search-container { background-color: #F8F8F8; min-height: 100vh; position: relative; }

    /* 1. ヘッダー固定エリア */
    .sticky-header { position: sticky; top: 0; z-index: 1000; background: white; border-bottom: 1px solid #eee; }
    
    .location-bar { 
        display: flex; align-items: center; padding: 10px 15px; background: #f2f2f2; 
        margin: 10px 15px; border-radius: 10px; font-size: 14px; font-weight: bold; 
        cursor: pointer; text-decoration: none; color: #333; 
    }
    .location-bar i { margin-right: 10px; font-size: 16px; }

    /* 2. 日付ナビ (スライド可能) */
    .date-scroll { display: flex; overflow-x: auto; padding: 5px 15px 15px; gap: 8px; -webkit-overflow-scrolling: touch; }
    .date-scroll::-webkit-scrollbar { display: none; }
    
    .date-link { text-decoration: none; color: inherit; flex-shrink: 0; }
    .date-item { 
        min-width: 55px; height: 75px; border: 1px solid #eee; border-radius: 12px; 
        display: flex; flex-direction: column; align-items: center; justify-content: center; 
        background: white; transition: 0.2s; 
    }
    .date-item.active { background: #FFD700; border: none; }
    .date-item .day-text { font-size: 10px; font-weight: bold; color: #666; margin-bottom: 4px; }
    .date-item.active .day-text { color: #333; }
    .date-item .date-num { font-size: 19px; font-weight: bold; }
    
    /* 曜日色設定 */
    .date-item.sun .date-num { color: #ff3b30; }
    .date-item.sat .date-num { color: #007AFF; }

    .sort-label-bar { padding: 12px 15px; display: flex; align-items: center; justify-content: space-between; font-size: 14px; font-weight: bold; border-top: 1px solid #f2f2f2; background: white; color: #333; }

    /* 3. 求人リストエリア */
    .job-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 15px 15px 120px; }
    .job-card { background: white; border-radius: 12px; border: 1px solid #eee; overflow: hidden; text-decoration: none; color: inherit; display: flex; flex-direction: column; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    .card-img { height: 110px; background: #eee; }
    .card-img img { width: 100%; height: 100%; object-fit: cover; }
    .card-body { padding: 10px; flex: 1; }
    .job-title { font-size: 12px; font-weight: bold; line-height: 1.4; height: 2.8em; overflow: hidden; margin-bottom: 8px; color: #333; }
    .job-price { font-size: 16px; font-weight: bold; color: #333; }

    .empty-state { grid-column: 1 / -1; text-align: center; padding: 150px 20px; color: #999; font-size: 15px; font-weight: bold; }

    /* 4. フローティングボタン (絞り込み) */
    .floating-filter { 
        position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); 
        background: #FFD700; padding: 12px 30px; border-radius: 30px; 
        font-weight: bold; box-shadow: 0 4px 15px rgba(0,0,0,0.2); 
        border: none; z-index: 500; cursor: pointer; display: flex; align-items: center; 
        gap: 8px; text-decoration: none; color: #333; font-size: 14px;
    }
</style>

<div class="search-container">
    <!-- ヘッダー：場所を指定 -->
    <div class="sticky-header">
        <a href="{% url 'location_home' %}" class="location-bar">
            <i class="fa-solid fa-location-dot"></i> 
            <span>{% if selected_prefs %}{{ selected_prefs|join:", " }}{% else %}場所を指定{% endif %}</span>
        </a>
        
        <!-- 日付ナビ -->
        <div class="date-scroll">
            {% for d in date_list %}
            <a href="?date={{ d|date:'Y-m-d' }}" class="date-link">
                <div class="date-item {% if d == selected_date %}active{% endif %} {% if d.weekday == 6 %}sun{% elif d.weekday == 5 %}sat{% endif %}">
                    <span class="day-text">{% if d == today %}今日{% else %}{{ d|date:"D" }}{% endif %}</span>
                    <span class="date-num">{{ d|date:"j" }}</span>
                </div>
            </a>
            {% endfor %}
        </div>

        <div class="sort-label-bar">
            <span><i class="fa-solid fa-bars-staggered"></i> 締切時刻が近い順</span>
            <i class="fa-solid fa-chevron-down" style="color:#ccc; font-size: 12px;"></i>
        </div>
    </div>

    <!-- お仕事リスト -->
    <div class="job-grid">
        {% for job in main_jobs %}
        <a href="{% url 'job_detail' job.pk %}" class="job-card">
            <div class="card-img">
                <img src="https://via.placeholder.com/200x120?text={{ job.template.occupation }}">
            </div>
            <div class="card-body">
                <div class="job-title">{{ job.title }}</div>
                <div class="job-price">¥{{ job.total_payment }}</div>
            </div>
        </a>
        {% empty %}
        <div class="empty-state">この日の仕事はまだありません</div>
        {% endfor %}
    </div>
</div>

<!-- 絞り込みボタン (別ページへ遷移) -->
<a href="{% url 'refine_home' %}" class="floating-filter">
    <i class="fa-solid fa-sliders"></i> 絞りこみ
</a>
{% endblock %}