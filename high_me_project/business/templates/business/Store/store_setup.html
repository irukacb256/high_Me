{% extends 'business/Common/base_signup.html' %}

{% block content %}
<style>
    /* 繝励Ο繧ｰ繝ｬ繧ｹ繝舌。 (繧ｹ繝。ャ繝。: 店舗登録が、い繧ｯ繝。ぅ繝。 */
    .stepper {
        display: flex;
        margin: -40px -40px 40px -40px;
        background: #fff;
        border-bottom: 1px solid #eee;
    }

    .step {
        flex: 1;
        padding: 15px 0;
        text-align: center;
        font-size: 11px;
        color: #007AFF;
        position: relative;
    }

    .step.inactive {
        color: #999;
    }

    .step.active {
        font-weight: bold;
        border-bottom: 3px solid #007AFF;
    }

    .step::before {
        content: '✓';
    }

    .step.no-check::before {
        content: '';
    }

    /* フォームスタイル (画像準拠) */
    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .section-title {
        font-weight: bold;
        font-size: 16px;
    }

    .reflect-btn {
        background: #007AFF;
        color: white;
        border: none;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 11px;
        font-weight: bold;
        cursor: pointer;
    }

    .form-item {
        margin-bottom: 20px;
        text-align: left;
    }

    .form-item label {
        display: block;
        font-size: 13px;
        font-weight: bold;
        margin-bottom: 8px;
        color: #333;
    }

    input,
    select {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 14px;
        box-sizing: border-box;
        background-color: #fff;
    }

    input::placeholder {
        color: #ccc;
    }

    .btn-register {
        background: #007AFF;
        color: white;
        border: none;
        width: 100%;
        padding: 16px;
        border-radius: 6px;
        font-weight: bold;
        font-size: 16px;
        margin-top: 30px;
        cursor: pointer;
    }
</style>

<!-- 進行バー -->
<div class="stepper">
    <div class="step">1. メール登録</div>
    <div class="step">2. アカウント登録</div>
    <div class="step">3. 事業者登録</div>
    <div class="step active no-check">4. 店舗登録</div>
</div>

<div class="form-body">
    <form method="POST" class="h-adr">
        <span class="p-country-name" style="display:none;">Japan</span>
        {% csrf_token %}

        {% if form.errors %}
        <div
            style="background:#ffebee; color:#d32f2f; padding:10px; border-radius:4px; margin-bottom:15px; font-weight:bold;">
            {% for field, errors in form.errors.items %}
            {% for error in errors %}
            {% if field != '__all__' %}
            <div>{{ field }}: {{ error }}</div>
            {% else %}
            <div>{{ error }}</div>
            {% endif %}
            {% endfor %}
            {% endfor %}
        </div>
        {% endif %}

        <div class="section-header">
            <span class="section-title">店舗の基本情報</span>
        </div>
        <div class="form-item">
            <label>店舗名</label>
            <input type="text" name="store_name" placeholder="例: タイミー 汐留店
                value=" {{ form.store_name.value|default:'' }}" required>
        </div>

        <div class="section-header" style="margin-top: 40px;">
            <span class="section-title">業務内容</span>
        </div>
        <div class="form-item">
            <label>業種</label>
            <select name="industry" id="industrySelect" required>
                <option value="">選択してください</option>
                <option value="飲食。フード">飲食。フード</option>
                <option value="販売。接客">販売。接客</option>
                <option value="物流。軽作業">物流。軽作業</option>
                <option value="オフィス">オフィス</option>
                <option value="その他">その他</option>
            </select>
        </div>

        <div class="section-header" style="margin-top: 40px;">
            <span class="section-title">店舗の所在地</span>
            <button type="button" class="reflect-btn">事業者所在地を反映する</button>
        </div>

        <div class="form-item">
            <label>郵便番号</label>
            <input type="text" name="post_code" class="p-postal-code" placeholder="例: 1700013"
                value="{{ form.post_code.value|default:'' }}" required>
        </div>

        <div class="form-item">
            <label>都道府県</label>
            <select name="prefecture" class="p-region">
                <option value="">選択してください</option>
                <option value="北海道">北海道</option>
                <option value="青森県">青森県</option>
                <option value="岩手県">岩手県</option>
                <option value="宮城県">宮城県</option>
                <option value="秋田県">秋田県</option>
                <option value="山形県">山形県</option>
                <option value="福島県">福島県</option>
                <option value="茨城県">茨城県</option>
                <option value="栃木県">栃木県</option>
                <option value="群馬県">群馬県</option>
                <option value="埼玉県">埼玉県</option>
                <option value="千葉県">千葉県</option>
                <option value="東京都">東京都</option>
                <option value="神奈川県">神奈川県</option>
                <option value="新潟県">新潟県</option>
                <option value="富山県">富山県</option>
                <option value="石川県">石川県</option>
                <option value="福井県">福井県</option>
                <option value="山梨県">山梨県</option>
                <option value="長野県">長野県</option>
                <option value="岐阜県">岐阜県</option>
                <option value="静岡県">静岡県</option>
                <option value="愛知県">愛知県</option>
                <option value="三重県">三重県</option>
                <option value="滋賀県">滋賀県</option>
                <option value="京都府">京都府</option>
                <option value="大阪府">大阪府</option>
                <option value="兵庫県">兵庫県</option>
                <option value="奈良県">奈良県</option>
                <option value="和歌山県">和歌山県</option>
                <option value="鳥取県">鳥取県</option>
                <option value="島根県">島根県</option>
                <option value="岡山県">岡山県</option>
                <option value="広島県">広島県</option>
                <option value="山口県">山口県</option>
                <option value="徳島県">徳島県</option>
                <option value="香川県">香川県</option>
                <option value="愛媛県">愛媛県</option>
                <option value="高知県">高知県</option>
                <option value="福岡県">福岡県</option>
                <option value="佐賀県">佐賀県</option>
                <option value="長崎県">長崎県</option>
                <option value="熊本県">熊本県</option>
                <option value="大分県">大分県</option>
                <option value="宮崎県">宮崎県</option>
                <option value="鹿児島県">鹿児島県</option>
                <option value="沖縄県">沖縄県</option>
            </select>
        </div>

        <div class="form-item">
            <label>市区町村名</label>
            <input type="text" name="city" class="p-locality" placeholder="例: 豊島区"
                value="{{ form.city.value|default:'' }}">
        </div>

        <div class="form-item">
            <label>町域。番地</label>
            <input type="text" name="address_line" class="p-street-address" placeholder="例: 東池袁E-1-18-1"
                value="{{ form.address_line.value|default:'' }}">
        </div>

        <div class="form-item">
            <label>建物名など</label>
            <input type="text" name="building" class="p-extended-address" placeholder="例: Hareza Tower 27隁E
                value=" {{ form.building.value|default:'' }}">
        </div>

        <button type="submit" class="btn-register">店舗を登録する</button>
    </form>
</div>

<script>
    document.querySelector('.reflect-btn').addEventListener('click', function () {
        // 繧ｻ繝。す繝ｧ繝ｳから貂｡され、歟iz_dataをJSで菴ｿえｋ繧医≧にする。育ｰ｡譏鍋噪）
        // テンプレ繝ｼ繝亥､画焚で逶ｴ謗･JS変数に埋め込む
        var bizPostCode = "{{ biz_data.biz_post_code|default:'' }}";
        var bizPrefecture = "{{ biz_data.biz_prefecture|default:'' }}";
        var bizCity = "{{ biz_data.biz_city|default:'' }}";
        var bizAddressLine = "{{ biz_data.biz_address_line|default:'' }}";
        var bizBuilding = "{{ biz_data.biz_building|default:'' }}";

        if (bizPostCode) document.querySelector('input[name="post_code"]').value = bizPostCode;
        if (bizPrefecture) document.querySelector('select[name="prefecture"]').value = bizPrefecture;
        if (bizCity) document.querySelector('input[name="city"]').value = bizCity;
        if (bizAddressLine) document.querySelector('input[name="address_line"]').value = bizAddressLine;
        if (bizBuilding) document.querySelector('input[name="building"]').value = bizBuilding;
    });

    // Restore form values on error
    document.addEventListener('DOMContentLoaded', function () {
        // Industry
        var selectedIndustry = "{{ form.industry.value|default:'' }}";
        if (selectedIndustry) {
            var sel = document.getElementById('industrySelect');
            if (sel) {
                for (var i = 0; i < sel.options.length; i++) {
                    if (sel.options[i].value === selectedIndustry) {
                        sel.options[i].selected = true;
                        break;
                    }
                }
            }
        }

        // Prefecture
        var selectedPref = "{{ form.prefecture.value|default:'' }}";
        if (selectedPref) {
            var prefSel = document.querySelector('select[name="prefecture"]');
            if (prefSel) {
                for (var i = 0; i < prefSel.options.length; i++) {
                    if (prefSel.options[i].value === selectedPref) {
                        prefSel.options[i].selected = true;
                        break;
                    }
                }
            }
        }
    });
</script>
{% endblock %}