{% extends 'business/Common/base_signup.html' %}

{% block content %}
<style>
    /* 繝励Ο繧ｰ繝ｬ繧ｹ繝舌・ (繧ｹ繝・ャ繝・: 蠎苓・逋ｻ骭ｲ縺後い繧ｯ繝・ぅ繝・ */
    .stepper {
        display: flex;
        margin: -40px -40px 40px -40px;
        background: #fff;
        border-bottom: 1px solid #eee;
    }

    .step {
        flex: 1;
        padding: 15px 0;
        text-align: center;
        font-size: 11px;
        color: #007AFF;
        position: relative;
    }

    .step.inactive {
        color: #999;
    }

    .step.active {
        font-weight: bold;
        border-bottom: 3px solid #007AFF;
    }

    .step::before {
        content: '笨・';
    }

    .step.no-check::before {
        content: '';
    }

    /* 繝輔か繝ｼ繝繧ｹ繧ｿ繧､繝ｫ (逕ｻ蜒・貅匁侠) */
    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .section-title {
        font-weight: bold;
        font-size: 16px;
    }

    .reflect-btn {
        background: #007AFF;
        color: white;
        border: none;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 11px;
        font-weight: bold;
        cursor: pointer;
    }

    .form-item {
        margin-bottom: 20px;
        text-align: left;
    }

    .form-item label {
        display: block;
        font-size: 13px;
        font-weight: bold;
        margin-bottom: 8px;
        color: #333;
    }

    input,
    select {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 14px;
        box-sizing: border-box;
        background-color: #fff;
    }

    input::placeholder {
        color: #ccc;
    }

    .btn-register {
        background: #007AFF;
        color: white;
        border: none;
        width: 100%;
        padding: 16px;
        border-radius: 6px;
        font-weight: bold;
        font-size: 16px;
        margin-top: 30px;
        cursor: pointer;
    }
</style>

<!-- 騾ｲ陦後ヰ繝ｼ -->
<div class="stepper">
    <div class="step">繝｡繝ｼ繝ｫ逋ｻ骭ｲ</div>
    <div class="step">繧｢繧ｫ繧ｦ繝ｳ繝育匳骭ｲ</div>
    <div class="step">3. 莠区･ｭ閠・匳骭ｲ</div>
    <div class="step active no-check">4. 蠎苓・逋ｻ骭ｲ</div>
</div>

<div class="form-body">
    <form method="POST" class="h-adr">
        <span class="p-country-name" style="display:none;">Japan</span>
        {% csrf_token %}

        {% if form.errors %}
        <div
            style="background:#ffebee; color:#d32f2f; padding:10px; border-radius:4px; margin-bottom:15px; font-weight:bold;">
            {% for field, errors in form.errors.items %}
            {% for error in errors %}
            {% if field != '__all__' %}
            <div>{{ field }}: {{ error }}</div>
            {% else %}
            <div>{{ error }}</div>
            {% endif %}
            {% endfor %}
            {% endfor %}
        </div>
        {% endif %}

        <div class="section-header">
            <span class="section-title">蠎苓・縺ｮ蝓ｺ譛ｬ諠・ｱ</span>
        </div>
        <div class="form-item">
            <label>蠎苓・蜷・/label>
            <input type="text" name="store_name" placeholder="萓・ 繧ｿ繧､繝溘・ 豎千蕗蠎・
                value="{{ form.store_name.value|default:'' }}" required>
        </div>

        <div class="section-header" style="margin-top: 40px;">
            <span class="section-title">讌ｭ蜍吝・螳ｹ</span>
        </div>
        <div class="form-item">
            <label>讌ｭ遞ｮ</label>
            <select name="industry" id="industrySelect" required>
                <option value="">驕ｸ謚槭＠縺ｦ縺上□縺輔＞</option>
                <option value="鬟ｲ鬟溘・繝輔・繝・>鬟ｲ鬟溘・繝輔・繝・/option>
                <option value="雋ｩ螢ｲ繝ｻ謗･螳｢">雋ｩ螢ｲ繝ｻ謗･螳｢</option>
                <option value="迚ｩ豬√・霆ｽ菴懈･ｭ">迚ｩ豬√・霆ｽ菴懈･ｭ</option>
                <option value="繧ｪ繝輔ぅ繧ｹ">繧ｪ繝輔ぅ繧ｹ</option>
                <option value="縺昴・莉・>縺昴・莉・/option>
            </select>
        </div>

        <div class="section-header" style="margin-top: 40px;">
            <span class="section-title">蠎苓・縺ｮ謇蝨ｨ蝨ｰ</span>
            <button type="button" class="reflect-btn">莠区･ｭ閠・・謇蝨ｨ蝨ｰ繧貞渚譏縺吶ｋ</button>
        </div>

        <div class="form-item">
            <label>驛ｵ萓ｿ逡ｪ蜿ｷ</label>
            <input type="text" name="post_code" class="p-postal-code" placeholder="萓・ 1700013"
                value="{{ form.post_code.value|default:'' }}" required>
        </div>

        <div class="form-item">
            <label>驛ｽ驕灘ｺ懃恁</label>
            <select name="prefecture" class="p-region">
                <option value="">驕ｸ謚槭＠縺ｦ縺上□縺輔＞</option>
                <option value="蛹玲ｵｷ驕・>蛹玲ｵｷ驕・/option>
                <option value="髱呈｣ｮ逵・>髱呈｣ｮ逵・/option>
                <option value="蟯ｩ謇狗恁">蟯ｩ謇狗恁</option>
                <option value="螳ｮ蝓守恁">螳ｮ蝓守恁</option>
                <option value="遘狗伐逵・>遘狗伐逵・/option>
                <option value="螻ｱ蠖｢逵・>螻ｱ蠖｢逵・/option>
                <option value="遖丞ｳｶ逵・>遖丞ｳｶ逵・/option>
                <option value="闌ｨ蝓守恁">闌ｨ蝓守恁</option>
                <option value="譬・惠逵・>譬・惠逵・/option>
                <option value="鄒､鬥ｬ逵・>鄒､鬥ｬ逵・/option>
                <option value="蝓ｼ邇臥恁">蝓ｼ邇臥恁</option>
                <option value="蜊・痩逵・>蜊・痩逵・/option>
                <option value="譚ｱ莠ｬ驛ｽ">譚ｱ莠ｬ驛ｽ</option>
                <option value="逾槫･亥ｷ晉恁">逾槫･亥ｷ晉恁</option>
                <option value="譁ｰ貎溽恁">譁ｰ貎溽恁</option>
                <option value="蟇悟ｱｱ逵・>蟇悟ｱｱ逵・/option>
                <option value="遏ｳ蟾晉恁">遏ｳ蟾晉恁</option>
                <option value="遖丈ｺ慕恁">遖丈ｺ慕恁</option>
                <option value="螻ｱ譴ｨ逵・>螻ｱ譴ｨ逵・/option>
                <option value="髟ｷ驥守恁">髟ｷ驥守恁</option>
                <option value="蟯宣・逵・>蟯宣・逵・/option>
                <option value="髱吝ｲ｡逵・>髱吝ｲ｡逵・/option>
                <option value="諢帷衍逵・>諢帷衍逵・/option>
                <option value="荳蛾㍾逵・>荳蛾㍾逵・/option>
                <option value="貊玖ｳ逵・>貊玖ｳ逵・/option>
                <option value="莠ｬ驛ｽ蠎・>莠ｬ驛ｽ蠎・/option>
                <option value="螟ｧ髦ｪ蠎・>螟ｧ髦ｪ蠎・/option>
                <option value="蜈ｵ蠎ｫ逵・>蜈ｵ蠎ｫ逵・/option>
                <option value="螂郁憶逵・>螂郁憶逵・/option>
                <option value="蜥梧ｭ悟ｱｱ逵・>蜥梧ｭ悟ｱｱ逵・/option>
                <option value="魑･蜿也恁">魑･蜿也恁</option>
                <option value="蟲ｶ譬ｹ逵・>蟲ｶ譬ｹ逵・/option>
                <option value="蟯｡螻ｱ逵・>蟯｡螻ｱ逵・/option>
                <option value="蠎・ｳｶ逵・>蠎・ｳｶ逵・/option>
                <option value="螻ｱ蜿｣逵・>螻ｱ蜿｣逵・/option>
                <option value="蠕ｳ蟲ｶ逵・>蠕ｳ蟲ｶ逵・/option>
                <option value="鬥吝ｷ晉恁">鬥吝ｷ晉恁</option>
                <option value="諢帛ｪ帷恁">諢帛ｪ帷恁</option>
                <option value="鬮倡衍逵・>鬮倡衍逵・/option>
                <option value="遖丞ｲ｡逵・>遖丞ｲ｡逵・/option>
                <option value="菴占ｳ逵・>菴占ｳ逵・/option>
                <option value="髟ｷ蟠守恁">髟ｷ蟠守恁</option>
                <option value="辭頑悽逵・>辭頑悽逵・/option>
                <option value="螟ｧ蛻・恁">螟ｧ蛻・恁</option>
                <option value="螳ｮ蟠守恁">螳ｮ蟠守恁</option>
                <option value="鮖ｿ蜈仙ｳｶ逵・>鮖ｿ蜈仙ｳｶ逵・/option>
                <option value="豐也ｸ・恁">豐也ｸ・恁</option>
            </select>
        </div>

        <div class="form-item">
            <label>蟶ょ玄逕ｺ譚大錐</label>
            <input type="text" name="city" class="p-locality" placeholder="萓・ 雎雁ｳｶ蛹ｺ"
                value="{{ form.city.value|default:'' }}">
        </div>

        <div class="form-item">
            <label>逕ｺ蝓溘・逡ｪ蝨ｰ</label>
            <input type="text" name="address_line" class="p-street-address" placeholder="萓・ 譚ｱ豎陲・-1-18-1"
                value="{{ form.address_line.value|default:'' }}">
        </div>

        <div class="form-item">
            <label>蟒ｺ迚ｩ蜷阪↑縺ｩ</label>
            <input type="text" name="building" class="p-extended-address" placeholder="萓・ Hareza Tower 27髫・
                value="{{ form.building.value|default:'' }}">
        </div>

        <button type="submit" class="btn-register">蠎苓・繧堤匳骭ｲ縺吶ｋ</button>
    </form>
</div>

<script>
    document.querySelector('.reflect-btn').addEventListener('click', function () {
        // 繧ｻ繝・す繝ｧ繝ｳ縺九ｉ貂｡縺輔ｌ縺歟iz_data繧谷S縺ｧ菴ｿ縺医ｋ繧医≧縺ｫ縺吶ｋ・育ｰ｡譏鍋噪・・
        // 繝・Φ繝励Ξ繝ｼ繝亥､画焚縺ｧ逶ｴ謗･JS螟画焚縺ｫ蝓九ａ霎ｼ繧
        var bizPostCode = "{{ biz_data.biz_post_code|default:'' }}";
        var bizPrefecture = "{{ biz_data.biz_prefecture|default:'' }}";
        var bizCity = "{{ biz_data.biz_city|default:'' }}";
        var bizAddressLine = "{{ biz_data.biz_address_line|default:'' }}";
        var bizBuilding = "{{ biz_data.biz_building|default:'' }}";

        if (bizPostCode) document.querySelector('input[name="post_code"]').value = bizPostCode;
        if (bizPrefecture) document.querySelector('select[name="prefecture"]').value = bizPrefecture;
        if (bizCity) document.querySelector('input[name="city"]').value = bizCity;
        if (bizAddressLine) document.querySelector('input[name="address_line"]').value = bizAddressLine;
        if (bizBuilding) document.querySelector('input[name="building"]').value = bizBuilding;
    });

    // Restore form values on error
    document.addEventListener('DOMContentLoaded', function () {
        // Industry
        var selectedIndustry = "{{ form.industry.value|default:'' }}";
        if (selectedIndustry) {
            var sel = document.getElementById('industrySelect');
            if (sel) {
                for (var i = 0; i < sel.options.length; i++) {
                    if (sel.options[i].value === selectedIndustry) {
                        sel.options[i].selected = true;
                        break;
                    }
                }
            }
        }

        // Prefecture
        var selectedPref = "{{ form.prefecture.value|default:'' }}";
        if (selectedPref) {
            var prefSel = document.querySelector('select[name="prefecture"]');
            if (prefSel) {
                for (var i = 0; i < prefSel.options.length; i++) {
                    if (prefSel.options[i].value === selectedPref) {
                        prefSel.options[i].selected = true;
                        break;
                    }
                }
            }
        }
    });
</script>
{% endblock %}
