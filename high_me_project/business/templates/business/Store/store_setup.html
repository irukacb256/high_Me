{% extends 'business/Common/base_signup.html' %}

{% block content %}
<style>
    /* ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãE (ã‚¹ãƒEƒƒãƒE: åº—èEç™»éŒ²ãŒã‚¢ã‚¯ãƒE‚£ãƒE */
    .stepper {
        display: flex;
        margin: -40px -40px 40px -40px;
        background: #fff;
        border-bottom: 1px solid #eee;
    }

    .step {
        flex: 1;
        padding: 15px 0;
        text-align: center;
        font-size: 11px;
        color: #007AFF;
        position: relative;
    }

    .step.inactive {
        color: #999;
    }

    .step.active {
        font-weight: bold;
        border-bottom: 3px solid #007AFF;
    }

    .step::before {
        content: 'âœE';
    }

    .step.no-check::before {
        content: '';
    }

    /* ãƒ•ã‚©ãƒ¼ãƒ ã‚¹ã‚¿ã‚¤ãƒ« (ç”»åƒEæº–æ‹ ) */
    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .section-title {
        font-weight: bold;
        font-size: 16px;
    }

    .reflect-btn {
        background: #007AFF;
        color: white;
        border: none;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 11px;
        font-weight: bold;
        cursor: pointer;
    }

    .form-item {
        margin-bottom: 20px;
        text-align: left;
    }

    .form-item label {
        display: block;
        font-size: 13px;
        font-weight: bold;
        margin-bottom: 8px;
        color: #333;
    }

    input,
    select {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 14px;
        box-sizing: border-box;
        background-color: #fff;
    }

    input::placeholder {
        color: #ccc;
    }

    .btn-register {
        background: #007AFF;
        color: white;
        border: none;
        width: 100%;
        padding: 16px;
        border-radius: 6px;
        font-weight: bold;
        font-size: 16px;
        margin-top: 30px;
        cursor: pointer;
    }
</style>

<!-- é€²è¡Œãƒãƒ¼ -->
<div class="stepper">
    <div class="step">ãƒ¡ãƒ¼ãƒ«ç™»éŒ²</div>
    <div class="step">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™»éŒ²</div>
    <div class="step">3. äº‹æ¥­è€E™»éŒ²</div>
    <div class="step active no-check">4. åº—èEç™»éŒ²</div>
</div>

<div class="form-body">
    <form method="POST" class="h-adr">
        <span class="p-country-name" style="display:none;">Japan</span>
        {% csrf_token %}

        {% if form.errors %}
        <div
            style="background:#ffebee; color:#d32f2f; padding:10px; border-radius:4px; margin-bottom:15px; font-weight:bold;">
            {% for field, errors in form.errors.items %}
            {% for error in errors %}
            {% if field != '__all__' %}
            <div>{{ field }}: {{ error }}</div>
            {% else %}
            <div>{{ error }}</div>
            {% endif %}
            {% endfor %}
            {% endfor %}
        </div>
        {% endif %}

        <div class="section-header">
            <span class="section-title">åº—èEã®åŸºæœ¬æƒE ±</span>
        </div>
        <div class="form-item">
            <label>åº—èEåE/label>
            <input type="text" name="store_name" placeholder="ä¾E ã‚¿ã‚¤ãƒŸãE æ±ç•™åºE
                value="{{ form.store_name.value|default:'' }}" required>
        </div>

        <div class="section-header" style="margin-top: 40px;">
            <span class="section-title">æ¥­å‹™åEå®¹</span>
        </div>
        <div class="form-item">
            <label>æ¥­ç¨®</label>
            <select name="industry" id="industrySelect" required>
                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                <option value="é£²é£ŸãEãƒ•ãEãƒE>é£²é£ŸãEãƒ•ãEãƒE/option>
                <option value="è²©å£²ãƒ»æ¥å®¢">è²©å£²ãƒ»æ¥å®¢</option>
                <option value="ç‰©æµãEè»½ä½œæ¥­">ç‰©æµãEè»½ä½œæ¥­</option>
                <option value="ã‚ªãƒ•ã‚£ã‚¹">ã‚ªãƒ•ã‚£ã‚¹</option>
                <option value="ããEä»E>ããEä»E/option>
            </select>
        </div>

        <div class="section-header" style="margin-top: 40px;">
            <span class="section-title">åº—èEã®æ‰€åœ¨åœ°</span>
            <button type="button" class="reflect-btn">äº‹æ¥­è€EEæ‰€åœ¨åœ°ã‚’åæ˜ ã™ã‚‹</button>
        </div>

        <div class="form-item">
            <label>éƒµä¾¿ç•ªå·</label>
            <input type="text" name="post_code" class="p-postal-code" placeholder="ä¾E 1700013"
                value="{{ form.post_code.value|default:'' }}" required>
        </div>

        <div class="form-item">
            <label>éƒ½é“åºœçœŒ</label>
            <select name="prefecture" class="p-region">
                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                <option value="åŒ—æµ·éE>åŒ—æµ·éE/option>
                <option value="é’æ£®çœE>é’æ£®çœE/option>
                <option value="å²©æ‰‹çœŒ">å²©æ‰‹çœŒ</option>
                <option value="å®®åŸçœŒ">å®®åŸçœŒ</option>
                <option value="ç§‹ç”°çœE>ç§‹ç”°çœE/option>
                <option value="å±±å½¢çœE>å±±å½¢çœE/option>
                <option value="ç¦å³¶çœE>ç¦å³¶çœE/option>
                <option value="èŒ¨åŸçœŒ">èŒ¨åŸçœŒ</option>
                <option value="æ Eœ¨çœE>æ Eœ¨çœE/option>
                <option value="ç¾¤é¦¬çœE>ç¾¤é¦¬çœE/option>
                <option value="åŸ¼ç‰çœŒ">åŸ¼ç‰çœŒ</option>
                <option value="åE‘‰çœE>åE‘‰çœE/option>
                <option value="æ±äº¬éƒ½">æ±äº¬éƒ½</option>
                <option value="ç¥å¥ˆå·çœŒ">ç¥å¥ˆå·çœŒ</option>
                <option value="æ–°æ½ŸçœŒ">æ–°æ½ŸçœŒ</option>
                <option value="å¯Œå±±çœE>å¯Œå±±çœE/option>
                <option value="çŸ³å·çœŒ">çŸ³å·çœŒ</option>
                <option value="ç¦äº•çœŒ">ç¦äº•çœŒ</option>
                <option value="å±±æ¢¨çœE>å±±æ¢¨çœE/option>
                <option value="é•·é‡çœŒ">é•·é‡çœŒ</option>
                <option value="å²éEçœE>å²éEçœE/option>
                <option value="é™å²¡çœE>é™å²¡çœE/option>
                <option value="æ„›çŸ¥çœE>æ„›çŸ¥çœE/option>
                <option value="ä¸‰é‡çœE>ä¸‰é‡çœE/option>
                <option value="æ»‹è³€çœE>æ»‹è³€çœE/option>
                <option value="äº¬éƒ½åºE>äº¬éƒ½åºE/option>
                <option value="å¤§é˜ªåºE>å¤§é˜ªåºE/option>
                <option value="å…µåº«çœE>å…µåº«çœE/option>
                <option value="å¥ˆè‰¯çœE>å¥ˆè‰¯çœE/option>
                <option value="å’Œæ­Œå±±çœE>å’Œæ­Œå±±çœE/option>
                <option value="é³¥å–çœŒ">é³¥å–çœŒ</option>
                <option value="å³¶æ ¹çœE>å³¶æ ¹çœE/option>
                <option value="å²¡å±±çœE>å²¡å±±çœE/option>
                <option value="åºE³¶çœE>åºE³¶çœE/option>
                <option value="å±±å£çœE>å±±å£çœE/option>
                <option value="å¾³å³¶çœE>å¾³å³¶çœE/option>
                <option value="é¦™å·çœŒ">é¦™å·çœŒ</option>
                <option value="æ„›åª›çœŒ">æ„›åª›çœŒ</option>
                <option value="é«˜çŸ¥çœE>é«˜çŸ¥çœE/option>
                <option value="ç¦å²¡çœE>ç¦å²¡çœE/option>
                <option value="ä½è³€çœE>ä½è³€çœE/option>
                <option value="é•·å´çœŒ">é•·å´çœŒ</option>
                <option value="ç†Šæœ¬çœE>ç†Šæœ¬çœE/option>
                <option value="å¤§åˆEœŒ">å¤§åˆEœŒ</option>
                <option value="å®®å´çœŒ">å®®å´çœŒ</option>
                <option value="é¹¿å…å³¶çœE>é¹¿å…å³¶çœE/option>
                <option value="æ²–ç¸EœŒ">æ²–ç¸EœŒ</option>
            </select>
        </div>

        <div class="form-item">
            <label>å¸‚åŒºç”ºæ‘å</label>
            <input type="text" name="city" class="p-locality" placeholder="ä¾E è±Šå³¶åŒº"
                value="{{ form.city.value|default:'' }}">
        </div>

        <div class="form-item">
            <label>ç”ºåŸŸãEç•ªåœ°</label>
            <input type="text" name="address_line" class="p-street-address" placeholder="ä¾E æ±æ± è¢E-1-18-1"
                value="{{ form.address_line.value|default:'' }}">
        </div>

        <div class="form-item">
            <label>å»ºç‰©åãªã©</label>
            <input type="text" name="building" class="p-extended-address" placeholder="ä¾E Hareza Tower 27éšE
                value="{{ form.building.value|default:'' }}">
        </div>

        <button type="submit" class="btn-register">åº—èEã‚’ç™»éŒ²ã™ã‚‹</button>
    </form>
</div>

<script>
    document.querySelector('.reflect-btn').addEventListener('click', function () {
        // ã‚»ãƒE‚·ãƒ§ãƒ³ã‹ã‚‰æ¸¡ã•ã‚ŒãŸbiz_dataã‚’JSã§ä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹Eˆç°¡æ˜“çš„EE
        // ãƒEƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¤‰æ•°ã§ç›´æ¥JSå¤‰æ•°ã«åŸ‹ã‚è¾¼ã‚€
        var bizPostCode = "{{ biz_data.biz_post_code|default:'' }}";
        var bizPrefecture = "{{ biz_data.biz_prefecture|default:'' }}";
        var bizCity = "{{ biz_data.biz_city|default:'' }}";
        var bizAddressLine = "{{ biz_data.biz_address_line|default:'' }}";
        var bizBuilding = "{{ biz_data.biz_building|default:'' }}";

        if (bizPostCode) document.querySelector('input[name="post_code"]').value = bizPostCode;
        if (bizPrefecture) document.querySelector('select[name="prefecture"]').value = bizPrefecture;
        if (bizCity) document.querySelector('input[name="city"]').value = bizCity;
        if (bizAddressLine) document.querySelector('input[name="address_line"]').value = bizAddressLine;
        if (bizBuilding) document.querySelector('input[name="building"]').value = bizBuilding;
    });

    // Restore form values on error
    document.addEventListener('DOMContentLoaded', function () {
        // Industry
        var selectedIndustry = "{{ form.industry.value|default:'' }}";
        if (selectedIndustry) {
            var sel = document.getElementById('industrySelect');
            if (sel) {
                for (var i = 0; i < sel.options.length; i++) {
                    if (sel.options[i].value === selectedIndustry) {
                        sel.options[i].selected = true;
                        break;
                    }
                }
            }
        }

        // Prefecture
        var selectedPref = "{{ form.prefecture.value|default:'' }}";
        if (selectedPref) {
            var prefSel = document.querySelector('select[name="prefecture"]');
            if (prefSel) {
                for (var i = 0; i < prefSel.options.length; i++) {
                    if (prefSel.options[i].value === selectedPref) {
                        prefSel.options[i].selected = true;
                        break;
                    }
                }
            }
        }
    });
</script>
{% endblock %}
