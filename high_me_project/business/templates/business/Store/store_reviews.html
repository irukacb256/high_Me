{% extends 'business/Common/dashboard_base.html' %}

{% block content %}
<style>
    .review-container {
        max-width: 900px;
        margin: 0 auto;
    }

    .page-header {
        margin-bottom: 25px;
    }

    .page-title {
        font-size: 24px;
        font-weight: bold;
        color: #333;
        margin-bottom: 8px;
    }

    .page-subtitle {
        color: #666;
        font-size: 14px;
    }

    .summary-card {
        background: white;
        border-radius: 12px;
        padding: 30px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        margin-bottom: 25px;
        display: flex;
        align-items: center;
        gap: 40px;
    }

    .good-rate-circle {
        position: relative;
        width: 120px;
        height: 120px;
        border-radius: 50%;

        background: conic-gradient(#4b60fa {
                    {
                    overall_good_rate
                }
            }

            %, #f0f0f0 {
                    {
                    overall_good_rate
                }
            }

            %);
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .good-rate-circle::before {
        content: "";
        position: absolute;
        width: 100px;
        height: 100px;
        border-radius: 50%;
        background: white;
    }

    .good-rate-content {
        position: relative;
        text-align: center;
        z-index: 1;
    }

    .good-rate-label {
        font-size: 12px;
        color: #666;
        font-weight: bold;
    }

    .good-rate-value {
        font-size: 32px;
        font-weight: bold;
        color: #333;
    }

    .good-rate-unit {
        font-size: 16px;
    }

    .breakdown-table {
        width: 100%;
        border-collapse: collapse;
    }

    .breakdown-row {
        border-bottom: 1px solid #eee;
    }

    .breakdown-row:last-child {
        border-bottom: none;
    }

    .breakdown-cell {
        padding: 15px 0;
        vertical-align: middle;
    }

    .item-label {
        font-size: 15px;
        font-weight: 500;
        color: #333;
        width: 60%;
    }

    .item-rate {
        font-weight: bold;
        font-size: 16px;
        text-align: right;
        width: 10%;
    }

    .item-counts {
        text-align: right;
    }

    .badge-count {
        display: inline-flex;
        align-items: center;
        font-size: 12px;
        padding: 4px 8px;
        border-radius: 4px;
        margin-left: 8px;
        font-weight: bold;
    }

    .badge-good {
        background: #e6fcf5;
        color: #0ca678;
    }

    .badge-bad {
        background: #fff5f5;
        color: #fa5252;
    }

    .review-list {
        background: white;
        border-radius: 12px;
        padding: 30px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }

    .review-item {
        display: flex;
        gap: 15px;
        padding-bottom: 25px;
        margin-bottom: 25px;
        border-bottom: 1px solid #eee;
    }

    .review-item:last-child {
        border-bottom: none;
        padding-bottom: 0;
        margin-bottom: 0;
    }

    .worker-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        object-fit: cover;
        background: #eee;
    }

    .review-content {
        flex: 1;
    }

    .review-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 5px;
    }

    .worker-name {
        font-weight: bold;
        color: #007bff;
        text-decoration: none;
        margin-right: 10px;
    }

    .job-title {
        font-size: 13px;
        color: #007bff;
    }

    .review-date {
        font-size: 12px;
        color: #999;
    }

    .review-comment {
        font-size: 14px;
        line-height: 1.6;
        color: #333;
        margin-top: 8px;
        white-space: pre-wrap;
    }
</style>

<div class="review-container">
    <div class="page-header">
        <h1 class="page-title">店舗へのレビュー</h1>
        <p class="page-subtitle">ワーカーからのレビューの概要と詳細が閲覧できます。</p>
    </div>

    <!-- Overall Summary & Breakdown -->
    <div class="summary-card">
        <!-- Circular Chart -->
        <div>
            <div class="good-rate-circle">
                <div class="good-rate-content">
                    <div class="good-rate-label">Good率</div>
                    <div class="good-rate-value">{{ overall_good_rate }}<span class="good-rate-unit">%</span></div>
                </div>
            </div>
        </div>

        <!-- Breakdown Table -->
        <div style="flex: 1;">
            <h3 style="font-size: 16px; font-weight: bold; margin-bottom: 15px;">項目別のGood率</h3>
            <table class="breakdown-table">
                <tr class="breakdown-row">
                    <td class="breakdown-cell item-label">働いた時間は求人内容どおりでしたか？</td>
                    <td class="breakdown-cell item-rate">{{ time_stats.rate }}%</td>
                    <td class="breakdown-cell item-counts">
                        <span class="badge-count badge-good"><i class="fa-solid fa-thumbs-up"></i> {{ time_stats.good
                            }}</span>
                        <span class="badge-count badge-bad"><i class="fa-solid fa-thumbs-down"></i> {{ time_stats.bad
                            }}</span>
                    </td>
                </tr>
                <tr class="breakdown-row">
                    <td class="breakdown-cell item-label">掲載されていた仕事内容通りでしたか？</td>
                    <td class="breakdown-cell item-rate">{{ content_stats.rate }}%</td>
                    <td class="breakdown-cell item-counts">
                        <span class="badge-count badge-good"><i class="fa-solid fa-thumbs-up"></i> {{ content_stats.good
                            }}</span>
                        <span class="badge-count badge-bad"><i class="fa-solid fa-thumbs-down"></i> {{ content_stats.bad
                            }}</span>
                    </td>
                </tr>
                <tr class="breakdown-row">
                    <td class="breakdown-cell item-label">またここで働きたいですか？</td>
                    <td class="breakdown-cell item-rate">{{ again_stats.rate }}%</td>
                    <td class="breakdown-cell item-counts">
                        <span class="badge-count badge-good"><i class="fa-solid fa-thumbs-up"></i> {{ again_stats.good
                            }}</span>
                        <span class="badge-count badge-bad"><i class="fa-solid fa-thumbs-down"></i> {{ again_stats.bad
                            }}</span>
                    </td>
                </tr>
            </table>
        </div>
    </div>

    <!-- Review List -->
    <div class="review-list">
        {% for review in reviews %}
        <div class="review-item">
            {% if review.worker.workerprofile.profile_image %}
            <img src="{{ review.worker.workerprofile.profile_image.url }}" class="worker-avatar" alt="Avatar">
            {% else %}
            <img src="https://via.placeholder.com/50?text={{ review.worker.last_name|slice:':1' }}"
                class="worker-avatar" alt="Avatar">
            {% endif %}

            <div class="review-content">
                <div class="review-header">
                    <div>
                        <a href="{% url 'biz_worker_detail' store.id review.worker.id %}" class="worker-name">
                            {% if review.worker.last_name %}
                            {{ review.worker.last_name }} {{ review.worker.first_name }}
                            {% else %}
                            {{ review.worker.username }}
                            {% endif %}
                        </a>
                        <a href="{% url 'biz_job_posting_detail' store.id review.job_application.job_posting.id %}"
                            class="job-title" style="text-decoration: none;">
                            【{{ review.job_application.job_posting.title }}】
                        </a>
                    </div>
                    <div class="review-date">{{ review.created_at|date:"Y年n月j日" }}</div>
                </div>
                <div class="review-comment">{{ review.comment }}</div>
            </div>
        </div>
        {% empty %}
        <div style="text-align: center; color: #999; padding: 20px;">
            まだレビューはありません。
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}