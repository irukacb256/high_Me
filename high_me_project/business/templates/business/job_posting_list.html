{% extends 'business/dashboard_base.html' %}

{% block content %}
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js'></script>

<style>
    .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .page-title { font-size: 22px; font-weight: bold; }

    /* åˆ‡ã‚Šæ›¿ãˆã‚¿ãƒ– */
    .view-switcher { display: flex; border: 1px solid #ddd; border-radius: 20px; background: white; padding: 2px; }
    .view-btn { padding: 8px 16px; border-radius: 18px; border: none; font-size: 13px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 5px; background: none; color: #666; }
    .view-btn.active { background: #eef6ff; color: #007AFF; }

    /* ãƒªã‚¹ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆç”»åƒ1å†ç¾ï¼‰ */
    .job-list-table { width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; margin-top: 20px; font-size: 13px; }
    .job-list-table th { background: #f9f9f9; padding: 15px; text-align: left; color: #888; border-bottom: 1px solid #eee; }
    .job-list-table td { padding: 20px 15px; border-bottom: 1px solid #eee; vertical-align: middle; }
    
    .status-badge { background: white; border: 1px solid #ddd; padding: 5px 15px; border-radius: 20px; color: #333; font-weight: bold; }
    .privacy-tag { background: #eef6ff; color: #007AFF; padding: 2px 8px; border-radius: 10px; font-size: 11px; margin-top: 5px; display: inline-block; }
    .job-link { color: #007AFF; font-weight: bold; text-decoration: underline; cursor: pointer; }
    .btn-copy-dropdown { background: #007AFF; color: white; border: none; padding: 8px 15px; border-radius: 4px; font-size: 12px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 5px; }

    #calendar-view, #list-view { display: none; }
    .visible { display: block !important; }
</style>

<div class="page-header">
    <h1 class="page-title">ã™ã¹ã¦ã®æ±‚äººä¸€è¦§</h1>
    <div class="view-switcher">
        <button class="view-btn active" id="btn-calendar" onclick="switchView('calendar')"><i class="fa-solid fa-calendar-days"></i> ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤º</button>
        <button class="view-btn" id="btn-list" onclick="switchView('list')"><i class="fa-solid fa-list-ul"></i> ãƒªã‚¹ãƒˆè¡¨ç¤º</button>
    </div>
</div>

<!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
<div id="calendar-view" class="visible">
    <div style="background: white; padding: 25px; border-radius: 8px; border: 1px solid #eee;">
        <div id="calendar"></div>
    </div>
</div>

<!-- ãƒªã‚¹ãƒˆè¡¨ç¤ºã‚¨ãƒªã‚¢ï¼ˆç”»åƒ1å†ç¾ï¼‰ -->
<div id="list-view">
    <table class="job-list-table">
        <thead>
            <tr>
                <th>æ±‚äººã®çŠ¶æ…‹</th>
                <th>å…¬é–‹è¨­å®š</th>
                <th>æ±‚äºº</th>
                <th>æ±‚äººæ—¥æ™‚</th>
                <th>ãƒ¯ãƒ¼ã‚«ãƒ¼</th>
                <th>æ“ä½œ</th>
            </tr>
        </thead>
        <tbody>
            {% for job in postings %}
            <tr>
                <td><span class="status-badge">æ±‚äººä¸­</span></td>
                <td>
                    <div>ä¸€èˆ¬å…¬é–‹</div>
                    <!-- ã‚°ãƒ«ãƒ¼ãƒ—é™å®šç­‰ã®å ´åˆã¯ã‚¿ã‚°ã‚’è¡¨ç¤º -->
                    {% if job.visibility == 'group' %}<span class="privacy-tag">æ¥å®¢ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆ</span>{% endif %}
                </td>
                <td>
                    <a href="{% url 'biz_job_posting_detail' store.id job.id %}" class="job-link">{{ job.title }}</a>
                </td>
                <td>
                    {{ job.work_date|date:"Yå¹´næœˆjæ—¥" }}ï¼ˆ{{ job.work_date|date:"D" }}ï¼‰<br>
                    <strong>{{ job.start_time|time:"H:i" }} ã€œ {{ job.end_time|time:"H:i" }}</strong>
                </td>
                <td>{{ job.matched_count|default:0 }} / {{ job.count }}äºº</td>
                <td>
                    <button class="btn-copy-dropdown"><i class="fa-regular fa-copy"></i> ã‚³ãƒ”ãƒ¼ <i class="fa-solid fa-chevron-down"></i></button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
    function switchView(view) {
        document.getElementById('calendar-view').classList.remove('visible');
        document.getElementById('list-view').classList.remove('visible');
        document.getElementById('btn-calendar').classList.remove('active');
        document.getElementById('btn-list').classList.remove('active');

        if (view === 'calendar') {
            document.getElementById('calendar-view').classList.add('visible');
            document.getElementById('btn-calendar').classList.add('active');
        } else {
            document.getElementById('list-view').classList.add('visible');
            document.getElementById('btn-list').classList.add('active');
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth', locale: 'ja',
            events: [{% for job in postings %}{ title: '{{ job.start_time|time:"H:i" }} ğŸ‘¤{{ job.matched_count }}/{{ job.count }}', start: '{{ job.work_date|date:"Y-m-d" }}', url: "{% url 'biz_job_posting_detail' store.id job.id %}" },{% endfor %}]
        });
        calendar.render();
    });
</script>
{% endblock %}