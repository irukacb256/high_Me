<style>
    /* Custom Calendar Grid Styling */
    .custom-calendar {
        width: 100%;
        border-collapse: collapse;
        table-layout: fixed;
    }

    .cal-header-row th {
        text-align: center;
        font-size: 13px;
        color: #666;
        padding: 10px 0;
        font-weight: normal;
    }

    .cal-header-row th.sunday {
        color: #ff3b30;
    }

    .cal-header-row th.saturday {
        color: #007AFF;
    }

    .cal-cell {
        height: 120px;
        border: 1px solid #eee;
        vertical-align: top;
        padding: 5px;
        cursor: pointer;
        background: white;
        transition: background 0.2s;
    }

    .cal-cell:hover {
        background: #f9f9f9;
        /* Image 2 shows "dimmed" effect on whole screen, but hover effect is good UX */
    }

    .cal-date-num {
        font-size: 14px;
        font-weight: 500;
        margin-bottom: 5px;
        display: inline-block;
        width: 24px;
        height: 24px;
        line-height: 24px;
        text-align: center;
        border-radius: 50%;
    }

    .cal-cell.today .cal-date-num {
        background: #007AFF;
        color: white;
    }

    .cal-cell.other-month {
        background: #fafafa;
    }

    .cal-cell.other-month .cal-date-num {
        color: #ccc;
    }

    /* Job Chip Styling (Image 1) */
    .cal-job-chip {
        display: block;
        background: #e6f7ed;
        /* Light Green */
        color: #1f8b4d;
        /* Dark Green */
        border-left: 3px solid #1f8b4d;
        font-size: 10px;
        padding: 3px 4px;
        margin-bottom: 3px;
        border-radius: 2px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        line-height: 1.3;
    }

    .cal-job-chip.filled {
        /* If full, maybe darker? Image 1 shows same color */
    }

    .cal-job-chip.gray-out {
        background: #eee;
        color: #999;
        border-left-color: #ccc;
    }

    .cal-more-link {
        font-size: 10px;
        color: #666;
        padding-left: 5px;
    }

    /* Sunday/Saturday Date Colors */
    .cal-cell.sunday .cal-date-num {
        color: #ff3b30;
    }

    .cal-cell.saturday .cal-date-num {
        color: #007AFF;
    }

    .cal-cell.today.sunday .cal-date-num,
    .cal-cell.today.saturday .cal-date-num {
        color: white;
    }

    /* Today override */
</style>

<table class="custom-calendar">
    <thead>
        <tr class="cal-header-row">
            <th class="sunday">譌･</th>
            <th>譛・/th>
            <th>轣ｫ</th>
            <th>豌ｴ</th>
            <th>譛ｨ</th>
            <th>驥・/th>
            <th class="saturday">蝨・/th>
        </tr>
    </thead>
    <tbody>
        {% for week in calendar_data %}
        <tr>
            {% for day in week %}
            <td class="cal-cell {% if not day.is_current_month %}other-month{% endif %} {% if day.is_today %}today{% endif %} {% if forloop.counter0 == 0 %}sunday{% elif forloop.counter0 == 6 %}saturday{% endif %}"
                onclick="openDayModal('{{ day.date|date:'Y-m-d' }}', '{{ day.date|date:'Y蟷ｴn譛・譌･' }}', {{ forloop.counter0 }})">

                <span class="cal-date-num">{{ day.day }}</span>
                {% if day.is_today and day.day == 1 %}<span style="font-size:10px; margin-left:2px;">蜈・律</span>{% endif
                %}

                <!-- Display up to 3 jobs, then +X more -->
                {% for job in day.postings|slice:":3" %}
                <div
                    class="cal-job-chip {% if job.is_ended or job.matched_count >= job.recruitment_count %}gray-out{% endif %}">
                    <span class="job-time">{{ job.start_time|time:"H:i" }}~{{ job.end_time|time:"H:i" }}</span>

                    <span class="job-icon" style="margin:0 4px;">
                        {% if job.matched_count >= job.recruitment_count %}
                        <i class="fa-regular fa-circle-check"></i>
                        {% else %}
                        <i class="fa-solid fa-user"></i>
                        {% endif %}
                    </span>

                    <span>
                        {% if job.recruitment_count > 1 %}
                        {{ job.matched_count }}/{{ job.recruitment_count }}
                        {% else %}
                        {{ job.matched_count }}/1
                        {% endif %}
                    </span>
                </div>
                {% endfor %}

                {% if day.postings|length > 3 %}
                <div class="cal-more-link">莉本{ day.postings|length|add:"-3" }}莉ｶ</div>
                {% endif %}

                <!-- Hidden Data for Modal -->
                <div id="data-{{ day.date|date:'Y-m-d' }}" style="display:none;">
                    {% for job in day.postings %}
                    <div class="job-data-item" data-id="{{ job.id }}" data-title="{{ job.title }}"
                        data-time="{{ job.start_time|time:'H:i' }} ~ {{ job.end_time|time:'H:i' }}"
                        data-status="{% if job.is_ended %}蜍滄寔邨ゆｺ・% elif job.matched_count >= job.recruitment_count %}遒ｺ螳壽ｸ医∩{% else %}蜍滄寔荳ｭ{% endif %}"
                        data-status-class="{% if job.is_ended %}badge-ended{% elif job.matched_count >= job.recruitment_count %}badge-done{% else %}badge-active{% endif %}"
                        data-visibility="{{ job.get_visibility_display }}"
                        data-people="{{ job.matched_count }} / {{ job.recruitment_count }}莠ｺ"
                        data-detail-url="{% url 'biz_job_posting_detail' store.id job.id %}">
                    </div>
                    {% endfor %}
                </div>
            </td>
            {% endfor %}
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Shared JS for Calendar Navigation (Simple Month Switching) -->
<script>
    function navigateCalendar(offset) {
        const urlParams = new URLSearchParams(window.location.search);
        let year = parseInt(urlParams.get('year') || '{{ current_year }}');
        let month = parseInt(urlParams.get('month') || '{{ current_month }}');

        month += offset;
        if (month > 12) { month = 1; year++; }
        if (month < 1) { month = 12; year--; }

        urlParams.set('year', year);
        urlParams.set('month', month);
        window.location.search = urlParams.toString();
    }
</script>
