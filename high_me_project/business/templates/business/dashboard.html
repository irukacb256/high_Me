{% extends 'business/dashboard_base.html' %}

{% block content %}
<!-- FullCalendar 6.1.8 CDN -->
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js'></script>

<style>
    /* 1. ãŠçŸ¥ã‚‰ã›ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
    .notice-section {
        background: white;
        padding: 20px 25px;
        border-radius: 8px;
        border: 1px solid #eee;
        margin-bottom: 25px;
    }
    .notice-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
    }
    .notice-title { font-weight: bold; font-size: 15px; color: #333; }
    .notice-link-all { font-size: 12px; color: #999; text-decoration: none; }
    .notice-list { list-style: none; padding: 0; margin: 0; }
    .notice-item { font-size: 13px; margin-bottom: 8px; }
    .notice-date { color: #333; margin-right: 15px; font-weight: 500; }
    .notice-text { color: #007AFF; text-decoration: none; }

    /* 2. ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ (7åˆ—ã‚°ãƒªãƒƒãƒ‰) */
    .quick-actions-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 12px;
        margin-bottom: 30px;
    }
    .action-btn {
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 15px 5px;
        text-align: center;
        text-decoration: none;
        color: #333;
        font-size: 11px;
        font-weight: bold;
        transition: 0.2s;
        position: relative;
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    .action-btn:hover { background: #f9f9f9; transform: translateY(-2px); }
    .action-btn i { font-size: 24px; margin-bottom: 10px; color: #555; }
    
    /* æ–°è¦å‹Ÿé›†ãƒœã‚¿ãƒ³ã®ã¿é’è‰² */
    .action-btn.primary { background: #007AFF; border: none; color: white; }
    .action-btn.primary i { color: white; }

    /* NEWãƒãƒƒã‚¸ */
    .badge-new {
        position: absolute; top: -8px; right: 5px;
        background: #ff3b30; color: white; padding: 2px 5px;
        border-radius: 4px; font-size: 9px;
    }

    /* 3. æ±‚äººä¸€è¦§ (ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¨ãƒªã‚¢) */
    .calendar-card {
        background: white;
        padding: 25px;
        border-radius: 8px;
        border: 1px solid #eee;
    }
    .calendar-top {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }
    .calendar-title { font-size: 18px; font-weight: bold; }

    /* åˆ‡æ›¿ã‚¿ãƒ– */
    .view-tabs { display: flex; background: #f0f0f0; padding: 4px; border-radius: 6px; }
    .tab-item {
        padding: 6px 15px; border-radius: 4px; border: none;
        font-size: 12px; font-weight: bold; cursor: pointer; color: #666; background: transparent;
    }
    .tab-item.active { background: white; color: #007AFF; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }

    /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼å†…éƒ¨ã®ã‚¹ã‚¿ã‚¤ãƒ«èª¿æ•´ */
    #calendar { font-size: 13px; }
    .fc-header-toolbar { margin-bottom: 20px !important; }
    .fc-toolbar-title { font-size: 16px !important; font-weight: bold; }
    .fc-day-sun .fc-col-header-cell-cushion { color: #ff3b30; }
    .fc-day-sat .fc-col-header-cell-cushion { color: #007AFF; }
    
    /* æ±‚äººã‚¹ãƒ­ãƒƒãƒˆï¼ˆã‚¤ãƒ™ãƒ³ãƒˆï¼‰ã®è¦‹ãŸç›® */
    .job-slot {
        font-size: 10px;
        padding: 2px 4px;
        background: #e6f7ed; /* è–„ã„ç·‘ */
        color: #1f8b4d;
        border-left: 3px solid #1f8b4d;
        border-radius: 2px;
        margin-bottom: 2px;
        white-space: nowrap;
        overflow: hidden;
    }
</style>

<!-- 1. é‡è¦ãªãŠçŸ¥ã‚‰ã› -->
<div class="notice-section">
    <div class="notice-header">
        <span class="notice-title">ã‚¿ã‚¤ãƒŸãƒ¼ã‹ã‚‰ã®é‡è¦ãªãŠçŸ¥ã‚‰ã›</span>
        <a href="#" class="notice-link-all">ã™ã¹ã¦ã®ãŠçŸ¥ã‚‰ã›ã‚’è¦‹ã‚‹</a>
    </div>
    <ul class="notice-list">
        <li class="notice-item">
            <span class="notice-date">2021å¹´8æœˆ2æ—¥</span>
            <a href="#" class="notice-text">8æœˆã®å®šæœŸãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã«ã¤ã„ã¦</a>
        </li>
        <li class="notice-item">
            <span class="notice-date">2021å¹´8æœˆ1æ—¥</span>
            <a href="#" class="notice-text">ãŠä»•äº‹ç”³ã—è¾¼ã¿åˆ¶é™ã®ä¸€éƒ¨ç·©å’Œã«ã¤ã„ã¦</a>
        </li>
        <li class="notice-item">
            <span class="notice-date">2021å¹´8æœˆ1æ—¥</span>
            <a href="#" class="notice-text">ãŠå•ã„åˆã‚ã›ç”¨LINEã«é–¢ã™ã‚‹ä¸å…·åˆã«ã¤ã„ã¦</a>
        </li>
    </ul>
</div>

<!-- 2. ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
<div class="quick-actions-grid">
    <a href="{% url 'biz_template_create' store.id %}" class="action-btn primary">
        <i class="fa-solid fa-circle-plus"></i>æ–°è¦å‹Ÿé›†
    </a>
    <a href="#" class="action-btn">
        <i class="fa-solid fa-qrcode"></i>ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³/ã‚¢ã‚¦ãƒˆ
    </a>
    <a href="#" class="action-btn">
        <i class="fa-solid fa-circle-exclamation"></i>ä¿®æ­£ä¾é ¼
    </a>
    <a href="#" class="action-btn">
        <i class="fa-solid fa-user-check"></i>ãƒ¯ãƒ¼ã‚«ãƒ¼è©•ä¾¡
    </a>
    <a href="#" class="action-btn">
        <i class="fa-solid fa-envelope"></i>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    </a>
    <a href="#" class="action-btn">
        <i class="fa-solid fa-user-plus"></i>æ‹›å¾…æ©Ÿèƒ½
    </a>
    <a href="#" class="action-btn">
        <span class="badge-new">NEW</span>
        <i class="fa-solid fa-address-book"></i>å°±æ¥­äºˆå®šè¡¨
    </a>
</div>

<!-- 3. æ±‚äººä¸€è¦§ï¼ˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ï¼‰ -->
<div class="calendar-card">
    <div class="calendar-top">
        <span class="calendar-title">æ±‚äººä¸€è¦§</span>
        <div class="view-tabs">
            <button class="tab-item active">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤º</button>
            <button class="tab-item" onclick="location.href='{% url 'biz_job_posting_list' store.id %}'">ãƒªã‚¹ãƒˆè¡¨ç¤º</button>
        </div>
    </div>

    <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æœ¬ä½“ -->
    <div id='calendar'></div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            locale: 'ja',
            height: 'auto',
            headerToolbar: {
                left: 'prev',
                center: 'title',
                right: 'next'
            },
            // ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰æ¸¡ã•ã‚ŒãŸæ±‚äººãƒ‡ãƒ¼ã‚¿ã‚’ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç”¨ã«å¤‰æ›
            events: [
                {% for job in postings %}
                {
                    title: '{{ job.start_time|time:"H:i" }}ã€œ{{ job.end_time|time:"H:i" }} ğŸ‘¤{{ job.count|default:"1" }}/{{ job.count|default:"1" }}',
                    start: '{{ job.work_date|date:"Y-m-d" }}',
                    url: '{% url "biz_job_posting_list" store.id %}' // ã‚¯ãƒªãƒƒã‚¯æ™‚ã®é·ç§»å…ˆï¼ˆä¾‹ï¼‰
                },
                {% endfor %}
            ],
            // ã‚¤ãƒ™ãƒ³ãƒˆã®è¦‹ãŸç›®ï¼ˆã‚¿ã‚¤ãƒŸãƒ¼é¢¨ã®ç·‘ã®æ ï¼‰ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
            eventContent: function(arg) {
                let italicEl = document.createElement('div');
                italicEl.className = 'job-slot';
                italicEl.innerHTML = arg.event.title;
                let arrayOfDomNodes = [ italicEl ];
                return { domNodes: arrayOfDomNodes };
            }
        });
        calendar.render();
    });
</script>
{% endblock %}